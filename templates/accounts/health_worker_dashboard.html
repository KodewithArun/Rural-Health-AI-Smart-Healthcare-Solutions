{% extends 'base.html' %}
{% load static %}

{% block title %}Health Worker Dashboard - Rural Health AI | Manage Appointments{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-6 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header Section -->
        <div class="mb-6">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                    <div>
                        <h1 class="text-2xl font-semibold text-gray-900 mb-1">
                            Welcome Back, Dr. {{ user.first_name }}
                        </h1>
                        <p class="text-sm text-gray-600 flex items-center gap-2">
                            <i class="ri-stethoscope-line text-blue-600"></i>
                            {% if health_profile %}{{ health_profile.specialization }}{% else %}Health Worker{% endif %}
                        </p>
                    </div>
                    <div class="mt-4 md:mt-0">
                        <div class="text-right">
                            <p class="text-xs text-gray-500 uppercase tracking-wide">Today's Date</p>
                            <p class="text-sm font-medium text-gray-900">{{ current_date|date:"F j, Y" }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <!-- Total Appointments -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Total Appointments</p>
                        <p class="text-3xl font-semibold text-gray-900">{{ total_appointments }}</p>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-3">
                        <i class="ri-calendar-check-line text-2xl text-blue-600"></i>
                    </div>
                </div>
            </div>

            <!-- Pending Appointments -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Pending</p>
                        <p class="text-3xl font-semibold text-gray-900">{{ pending_appointments }}</p>
                    </div>
                    <div class="bg-amber-50 rounded-lg p-3">
                        <i class="ri-time-line text-2xl text-amber-600"></i>
                    </div>
                </div>
            </div>

            <!-- Approved Appointments -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Approved</p>
                        <p class="text-3xl font-semibold text-gray-900">{{ approved_appointments }}</p>
                    </div>
                    <div class="bg-emerald-50 rounded-lg p-3">
                        <i class="ri-check-double-line text-2xl text-emerald-600"></i>
                    </div>
                </div>
            </div>

            <!-- Total Patients -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-1">Total Patients</p>
                        <p class="text-3xl font-semibold text-gray-900">{{ total_villagers }}</p>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-3">
                        <i class="ri-user-heart-line text-2xl text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Today's Appointments -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="border-b border-gray-200 px-6 py-4">
                    <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                        <i class="ri-calendar-today-line mr-2 text-blue-600"></i>
                        Today's Appointments
                    </h2>
                </div>
                <div class="p-6">
                    {% if todays_appointments %}
                        <div class="space-y-3">
                            {% for appointment in todays_appointments %}
                            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 hover:border-blue-300 transition-colors duration-200">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-4">
                                        <div class="bg-white rounded-lg p-2.5 border border-gray-200">
                                            <i class="ri-user-line text-xl text-gray-700"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-medium text-gray-900">{{ appointment.villager.first_name }} {{ appointment.villager.last_name }}</h3>
                                            <p class="text-sm text-gray-600 mt-0.5">{{ appointment.reason|truncatewords:8 }}</p>
                                            <p class="text-xs text-gray-500 mt-1 flex items-center">
                                                <i class="ri-time-line mr-1"></i> {{ appointment.time|time:"h:i A" }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium border
                                            {% if appointment.status == 'pending' %}bg-amber-50 text-amber-700 border-amber-200
                                            {% elif appointment.status == 'approved' %}bg-emerald-50 text-emerald-700 border-emerald-200
                                            {% elif appointment.status == 'completed' %}bg-blue-50 text-blue-700 border-blue-200
                                            {% else %}bg-red-50 text-red-700 border-red-200{% endif %}">
                                            {{ appointment.get_status_display }}
                                        </span>
                                        <div class="mt-2 flex gap-2">
                                            <a href="{% url 'appointments:detail' appointment.pk %}" 
                                               class="inline-flex items-center text-indigo-600 hover:text-indigo-700 text-sm font-medium">
                                                <i class="ri-eye-line mr-1"></i> View
                                            </a>
                                            <a href="{% url 'appointments:update' appointment.pk %}" 
                                               class="inline-flex items-center text-blue-600 hover:text-blue-700 text-sm font-medium">
                                                <i class="ri-edit-line mr-1"></i> Update
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-12">
                            <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                                <i class="ri-calendar-line text-3xl text-gray-400"></i>
                            </div>
                            <p class="text-gray-600 text-sm">No appointments scheduled for today</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Quick Stats & Status -->
            <div class="space-y-6">
                <!-- Status Distribution -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="border-b border-gray-200 px-6 py-4">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="ri-pie-chart-line mr-2 text-blue-600"></i>
                            Status Overview
                        </h2>
                    </div>
                    <div class="p-6 space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-amber-500 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-gray-700">Pending</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ pending_appointments }}</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-emerald-500 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-gray-700">Approved</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ approved_appointments }}</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-gray-700">Completed</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ completed_appointments }}</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-red-500 rounded-full mr-3"></div>
                                <span class="text-sm font-medium text-gray-700">Cancelled</span>
                            </div>
                            <span class="text-lg font-semibold text-gray-900">{{ cancelled_appointments }}</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="border-b border-gray-200 px-6 py-4">
                        <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                            <i class="ri-flashlight-line mr-2 text-blue-600"></i>
                            Quick Actions
                        </h2>
                    </div>
                    <div class="p-6 space-y-3">
                        <a href="{% url 'appointments:list' %}" 
                           class="flex items-center justify-between p-3.5 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-all duration-200 group">
                            <span class="font-medium text-gray-700 flex items-center text-sm">
                                <i class="ri-calendar-check-line text-blue-600 mr-3 text-lg"></i>
                                View All Appointments
                            </span>
                            <i class="ri-arrow-right-line text-blue-600 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                        <a href="{% url 'accounts:profile' %}" 
                           class="flex items-center justify-between p-3.5 bg-gray-50 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-all duration-200 group">
                            <span class="font-medium text-gray-700 flex items-center text-sm">
                                <i class="ri-user-settings-line text-blue-600 mr-3 text-lg"></i>
                                Edit Profile
                            </span>
                            <i class="ri-arrow-right-line text-blue-600 group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming & Recent Appointments -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Upcoming Appointments -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="border-b border-gray-200 px-6 py-4">
                    <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                        <i class="ri-calendar-event-line mr-2 text-emerald-600"></i>
                        Upcoming Appointments
                    </h2>
                </div>
                <div class="p-6">
                    {% if upcoming_appointments %}
                        <div class="space-y-3">
                            {% for appointment in upcoming_appointments %}
                            <div class="flex items-center justify-between p-3.5 bg-gray-50 rounded-lg border border-gray-200 hover:border-emerald-300 transition-colors duration-200">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-white rounded-lg p-2 border border-gray-200">
                                        <i class="ri-user-line text-emerald-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 text-sm">{{ appointment.villager.first_name }} {{ appointment.villager.last_name }}</h4>
                                        <p class="text-xs text-gray-500 mt-0.5 flex items-center">
                                            <i class="ri-calendar-line mr-1"></i> {{ appointment.date|date:"M d" }} at {{ appointment.time|time:"h:i A" }}
                                        </p>
                                    </div>
                                </div>
                                <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border
                                    {% if appointment.status == 'pending' %}bg-amber-50 text-amber-700 border-amber-200
                                    {% else %}bg-emerald-50 text-emerald-700 border-emerald-200{% endif %}">
                                    {{ appointment.get_status_display }}
                                </span>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8">
                            <div class="bg-gray-100 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                <i class="ri-calendar-line text-2xl text-gray-400"></i>
                            </div>
                            <p class="text-gray-600 text-sm">No upcoming appointments</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Recent Appointments -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="border-b border-gray-200 px-6 py-4">
                    <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                        <i class="ri-history-line mr-2 text-purple-600"></i>
                        Recent Appointments
                    </h2>
                </div>
                <div class="p-6">
                    {% if recent_appointments %}
                        <div class="space-y-3">
                            {% for appointment in recent_appointments %}
                            <div class="flex items-center justify-between p-3.5 bg-gray-50 rounded-lg border border-gray-200 hover:border-purple-300 transition-colors duration-200">
                                <div class="flex items-center space-x-3">
                                    <div class="bg-white rounded-lg p-2 border border-gray-200">
                                        <i class="ri-user-line text-purple-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 text-sm">{{ appointment.villager.first_name }} {{ appointment.villager.last_name }}</h4>
                                        <p class="text-xs text-gray-500 mt-0.5 flex items-center">
                                            <i class="ri-calendar-line mr-1"></i> {{ appointment.date|date:"M d" }} at {{ appointment.time|time:"h:i A" }}
                                        </p>
                                    </div>
                                </div>
                                <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border
                                    {% if appointment.status == 'completed' %}bg-blue-50 text-blue-700 border-blue-200
                                    {% elif appointment.status == 'cancelled' %}bg-red-50 text-red-700 border-red-200
                                    {% elif appointment.status == 'approved' %}bg-emerald-50 text-emerald-700 border-emerald-200
                                    {% else %}bg-amber-50 text-amber-700 border-amber-200{% endif %}">
                                    {{ appointment.get_status_display }}
                                </span>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8">
                            <div class="bg-gray-100 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                <i class="ri-history-line text-2xl text-gray-400"></i>
                            </div>
                            <p class="text-gray-600 text-sm">No recent appointments</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}